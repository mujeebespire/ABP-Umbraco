@inherits UmbracoViewPage<BlockListItem>
@using Umbraco.Cms.Core.Models.Blocks
@using Umbraco.Extensions
@using ABP.Web.Models.UmbracoModels

@{
    var content = Model.Content as LatestNewsImageCards;
    if (content == null) return;

    var heading = content.Value<string>("heading");
    var imageCards = content.ImageCards;
}

<div class="related-content has-margin-bottom">
    <div class="wrap wrap--small">
        @if (!string.IsNullOrWhiteSpace(heading))
        {
            <h3 class="h4 related-content__main-title">@heading</h3>
        }

        <div class="row">
            @if (imageCards != null && imageCards.Any())
            {
                foreach (var item in imageCards)
                {
                    var card = item.Content as CardsWithImages;
                    if (card == null) continue;

                    var image = card.Image;
                    var imageUrl = image?.Url() ?? "";

                    var imageTitle = card.Value<string>("imageTitle");
                    var latestNews = card.Value<bool>("latestNews");
                    var group = card.Value<string>("group");
                    var description = card.Value<string>("description");
                    var date = card.Value<DateTime?>("date");
                    var cta = card.Cta;

                    var formattedDate = (date.HasValue && date.Value != DateTime.MinValue)
                    ? date.Value.ToString("dd MMMM yyyy")
                    : null;

                    <div class="col-lg-6 col-md-6 related-content__box js-clickable">
                        @if (cta != null)
                        {
                            <div class="related-content__container" style="background-image: url('@imageUrl');">

                                @if (!string.IsNullOrWhiteSpace(group) || latestNews)
                                {
                                    <div class="related-content__category-wrapper">
                                        @* ✅ If both are ON — show side by side *@
                                        @if (!string.IsNullOrWhiteSpace(group) && latestNews)
                                        {
                                            <span class="related-content__category">@group</span>
                                            <span class="related-content__category-date">Latest News</span>
                                        }
                                      
                                        @* ✅ If only latestNews — show as usual *@
                                        else
                                        {
                                            <span class="related-content__category-date">@group</span>
                                        }
                                    </div>
                                }

                                @if (!string.IsNullOrWhiteSpace(imageTitle))
                                {
                                    <h5 class="related-content__subtitle">@imageTitle</h5>
                                }

                                @if (!string.IsNullOrWhiteSpace(description))
                                {
                                    <h5 class="related-content__subtitle related-content__subtitle--bold">@Html.Raw(description)</h5>
                                }

                                @if (!string.IsNullOrWhiteSpace(formattedDate))
                                {
                                    <span class="related-content__date">@formattedDate</span>
                                }
                    
                                <a href="@cta.Url" target="@(cta.Target)" class="related-content__link icon font-ico-ar-right" aria-label="@imageTitle"></a>
                            </div>
                        }
                    </div>
                }
            }
        </div>
    </div>
</div>
